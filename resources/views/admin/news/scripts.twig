<script>
    var formMode = '{{ FormMode }}';
    var formVals = [];

    if (formMode == 'edit') {

        // This is used when editing existing news items.
        formVals['title'] = "{{ NewsData.title|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['category_id'] = "{{ NewsData.category.id }}";
        formVals['url'] = "{{ NewsData.url }}";
        formVals['game_id'] = "{{ NewsData.game.id }}";

    } else {

        // This is used for new news items.
        // It's also used when submitting the edit version, to avoid the DB data overwriting the form.
        formVals['title'] = "{{ old('title')|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['category_id'] = "{{ old('category_id') }}";
        formVals['url'] = "{{ old('url') }}";
        formVals['game_id'] = "{{ old('game_id') }}";

    }

    $('#title').val(formVals['title']);
    $('#category_id').val(formVals['category_id']);
    $('#url').val(formVals['url']);
    $('#game_id').val(formVals['game_id']);

    $('#game_id').select2();

    $('#url').on('focus', function() {
        useAutoUrl('url');
    });
    $('#url').on('blur', function() {
        useAutoUrl('url');
    });

    function useAutoUrl(elem) {
        if ($('#' + elem).val() == '') {
            var date = new Date();
            dateString = date.yyyymmdd();
            $('#' + elem).val('/news/' + dateString + '/');
        }
    }

    // Date formatting
    Date.prototype.yyyymmdd = function() {
        var mm = this.getMonth() + 1;
        var dd = this.getDate();

        return [this.getFullYear(),
            (mm > 9 ? '' : '0') + mm,
            (dd > 9 ? '' : '0') + dd
        ].join('');
    };

    // CKEditor setup
    var ckEditorElem = 'content_html';

</script>
<script type="text/javascript" src="/js/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="/js/editor.js"></script>
