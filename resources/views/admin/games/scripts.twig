<script>
    var formMode = '{{ FormMode }}';
    var formVals = [];

    if (formMode == 'edit') {

        // This is used when editing existing games.
        // *** Main *** //
        formVals['title'] = "{{ GameData.title|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['link_title'] = "{{ GameData.link_title }}";
        formVals['primary_type_id'] = "{{ GameData.primary_type_id }}";
        formVals['series_id'] = "{{ GameData.series_id }}";
        // *** Dates *** //
        formVals['eu_release_date'] = "{{ GameData.eu_release_date }}";
        formVals['us_release_date'] = "{{ GameData.us_release_date }}";
        formVals['jp_release_date'] = "{{ GameData.jp_release_date }}";
        formVals['eu_is_released'] = "{{ GameData.eu_is_released }}";
        // *** eShop *** //
        formVals['eshop_europe_fs_id'] = "{{ GameData.eshop_europe_fs_id }}";
        formVals['price_eshop'] = "{{ GameData.price_eshop }}";
        formVals['players'] = "{{ GameData.players }}";
        formVals['eu_released_on'] = "{{ GameData.eu_released_on }}";
        formVals['boxart_square_url'] = "{{ GameData.boxart_square_url }}";
        formVals['boxart_header_image'] = "{{ GameData.boxart_header_image }}";
        // *** Additional *** //
        formVals['amazon_uk_link'] = "{{ GameData.amazon_uk_link }}";
        // *** Media *** //
        formVals['video_url'] = "{{ GameData.video_url }}";

    } else {

        // This is used for new games.
        // It's also used when submitting the edit version, to avoid the DB data overwriting the form.
        // *** Main *** //
        formVals['title'] = "{{ old('title')|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['link_title'] = "{{ old('link_title') }}";
        formVals['primary_type_id'] = "{{ old('primary_type_id') }}";
        formVals['series_id'] = "{{ old('series_id') }}";
        // *** Dates *** //
        formVals['eu_release_date'] = "{{ old('eu_release_date') }}";
        formVals['us_release_date'] = "{{ old('us_release_date') }}";
        formVals['jp_release_date'] = "{{ old('jp_release_date') }}";
        formVals['eu_is_released'] = "{{ old('eu_is_released') }}";
        // *** eShop *** //
        formVals['eshop_europe_fs_id'] = "{{ old('eshop_europe_fs_id') }}";
        formVals['price_eshop'] = "{{ old('price_eshop') }}";
        formVals['players'] = "{{ old('players') }}";
        formVals['eu_released_on'] = "{{ old('eu_released_on') }}";
        formVals['boxart_square_url'] = "{{ old('boxart_square_url') }}";
        formVals['boxart_header_image'] = "{{ old('boxart_header_image') }}";
        // *** Additional *** //
        formVals['amazon_uk_link'] = "{{ old('amazon_uk_link') }}";
        // *** Media *** //
        formVals['video_url'] = "{{ old('video_url') }}";

    }

    // Enable tabs
    $('#tabs').tabs();

    // *** Main *** //
    $('#title').val(formVals['title']);
    $('#link_title').val(formVals['link_title']);
    $('#primary_type_id').val(formVals['primary_type_id']);
    $('#series_id').val(formVals['series_id']);
    // *** Dates *** //
    $('#eu_release_date').val(formVals['eu_release_date']);
    $('#us_release_date').val(formVals['us_release_date']);
    $('#jp_release_date').val(formVals['jp_release_date']);
    if (formVals['eu_is_released'] == 1) {
        $('#eu_is_released').attr('checked', true);
    }
    // *** eShop *** //
    $('#eshop_europe_fs_id').val(formVals['eshop_europe_fs_id']);
    $('#price_eshop').val(formVals['price_eshop']);
    $('#players').val(formVals['players']);
    $('#eu_released_on').val(formVals['eu_released_on']);
    $('#boxart_square_url').val(formVals['boxart_square_url']);
    $('#boxart_header_image').val(formVals['boxart_header_image']);
    // *** Additional *** //
    $('#amazon_uk_link').val(formVals['amazon_uk_link']);
    // *** Media *** //
    $('#video_url').val(formVals['video_url']);

    // *** Genres *** //
    {% if GameGenreList %}
    {% for item in GameGenreList %}
        $('#genre_item_{{ item.genre_id }}').attr('checked', true);
    {% endfor %}
    {% endif %}

    $('#eshop_europe_fs_id').select2();

    // Autogenerate link URL
    $('#title').on('blur', function() {
        if ($('#link_title').val() != '') {
            return false;
        }
        gameTitle = $(this).val();
        if (gameTitle == '') {
            $('#link_title').val('');
            return false;
        }

        $.getJSON('/api/url/link-text', {title: gameTitle}, function(data) {
            linkText = data.linkText;
            //console.log(linkText);
            $('#link_title').val(linkText);
        });
    });

    // Save, return to list
    $('#btn-submit').on('click', function() {
        $('#btn-submit').click();
    });

    // Save, go to next
    $('#btn-save-go-to-next').on('click', function() {
        nextId = '{{ GameListFilterNextId }}';
        if (nextId != '') {
            $('#button_pressed').val("save-go-to-next");
            $('#nav_next_id').val(nextId);
            $('#btn-submit').click();
        }
    });
    // Skip
    $('#btn-skip-go-to-next').on('click', function() {
        $('#button_pressed').val("skip-go-to-next");
        nextPageUrl = '/admin/games/edit/{{ GameListFilterNextId }}?filter={{ GameListFilter }}';
        //console.log(nextPageUrl);
        top.location.href = nextPageUrl;
        return false;
    });

</script>
