<script>
    var formMode = '{{ FormMode }}';
    var formVals = [];

    if (formMode == 'edit') {

        // This is used when editing existing games.
        // *** Main *** //
        formVals['title'] = "{{ GameData.title|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['link_title'] = "{{ GameData.link_title }}";
        formVals['category_id'] = "{{ GameData.category_id }}";
        formVals['series_id'] = "{{ GameData.series_id }}";
        formVals['price_eshop'] = "{{ GameData.price_eshop }}";
        formVals['players'] = "{{ GameData.players }}";
        // *** Dates *** //
        formVals['eu_release_date'] = "{{ GameData.eu_release_date }}";
        formVals['us_release_date'] = "{{ GameData.us_release_date }}";
        formVals['jp_release_date'] = "{{ GameData.jp_release_date }}";
        formVals['eu_is_released'] = "{{ GameData.eu_is_released }}";
        formVals['eu_released_on'] = "{{ GameData.eu_released_on }}";
        // *** Additional *** //
        formVals['video_url'] = "{{ GameData.video_url }}";
        formVals['amazon_uk_link'] = "{{ GameData.amazon_uk_link }}";

    } else {

        // This is used for new games.
        // It's also used when submitting the edit version, to avoid the DB data overwriting the form.
        // *** Main *** //
        formVals['title'] = "{{ old('title')|replace({'\"': '\\"', '&quot;': '\\"'})|raw }}";
        formVals['link_title'] = "{{ old('link_title') }}";
        formVals['category_id'] = "{{ old('category_id') }}";
        formVals['series_id'] = "{{ old('series_id') }}";
        formVals['price_eshop'] = "{{ old('price_eshop') }}";
        formVals['players'] = "{{ old('players') }}";
        // *** Dates *** //
        formVals['eu_release_date'] = "{{ old('eu_release_date') }}";
        formVals['us_release_date'] = "{{ old('us_release_date') }}";
        formVals['jp_release_date'] = "{{ old('jp_release_date') }}";
        formVals['eu_is_released'] = "{{ old('eu_is_released') }}";
        formVals['eu_released_on'] = "{{ old('eu_released_on') }}";
        // *** Additional *** //
        formVals['video_url'] = "{{ old('video_url') }}";
        formVals['amazon_uk_link'] = "{{ old('amazon_uk_link') }}";

    }

    // Enable tabs
    $('#tabs').tabs();

    // *** Main *** //
    $('#title').val(formVals['title']);
    $('#link_title').val(formVals['link_title']);
    $('#category_id').val(formVals['category_id']);
    $('#series_id').val(formVals['series_id']);
    $('#price_eshop').val(formVals['price_eshop']);
    $('#players').val(formVals['players']);
    // *** Dates *** //
    $('#eu_release_date').val(formVals['eu_release_date']);
    $('#us_release_date').val(formVals['us_release_date']);
    $('#jp_release_date').val(formVals['jp_release_date']);
    if (formVals['eu_is_released'] == 1) {
        $('#eu_is_released').attr('checked', true);
    }
    $('#eu_released_on').val(formVals['eu_released_on']);
    // *** Additional *** //
    $('#video_url').val(formVals['video_url']);
    $('#amazon_uk_link').val(formVals['amazon_uk_link']);

    // *** Genres *** //
    {% if GameGenreList %}
    {% for item in GameGenreList %}
        $('#genre_item_{{ item.genre_id }}').attr('checked', true);
    {% endfor %}
    {% endif %}

    // Autogenerate link URL
    $('#title').on('blur', function() {
        if ($('#link_title').val() != '') {
            return false;
        }
        gameTitle = $(this).val();
        if (gameTitle == '') {
            $('#link_title').val('');
            return false;
        }

        $.getJSON('/api/url/link-text', {title: gameTitle}, function(data) {
            linkText = data.linkText;
            //console.log(linkText);
            $('#link_title').val(linkText);
        });
    });

</script>
